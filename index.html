<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" /><meta name="viewport" content="width=device-width,initial-scale=1" />
<title>European Economic Stats</title>
<style>
:root{--base-font:10px}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:#eef;color:#111;text-align:center}
#controls{padding:8px}
select,#go{padding:9px 12px;font-size:12px;border-radius:6px;border:1px solid #bbb;background:#fff}
#go{margin-left:8px;border:0;background:#2b7cff;color:#fff;cursor:pointer}
#mapWrap{position:relative;width:95%;max-width:1100px;margin:12px auto}
#mapImg{display:block;width:100%;height:auto}
.pin{position:absolute;transform:translate(-50%,-50%);white-space:nowrap;display:flex;align-items:center;padding:3px 6px;border-radius:3px;background:rgba(255,255,255,.9);box-shadow:0 1px 2px rgba(0,0,0,.12);pointer-events:auto}
.pin img{width:18px;height:12px;margin-right:6px;display:inline-block}
.fam-geo{background:rgba(150,200,255,.9)} /* germanic/geo */
.fam-rom{background:rgba(170,255,170,.9)} /* romance */
.fam-sla{background:rgba(255,160,160,.95)} /* slavic */
.fam-ural{background:rgba(255,255,150,.9)} /* uralic/other */
.fam-bal{background:rgba(220,180,255,.9)} /* baltic */
#legend{max-width:800px;margin:6px auto;font-size:12px}
#status{font-size:11px;color:#555;margin-top:5px}
</style>
</head>
<body>

<div id="controls">
<select id="stat">
<option value="GDP">GDP (current US$, latest)</option>
<option value="GDPpc">GDP per capita (current US$)</option>
<option value="Infl">Inflation (annual %)</option>
<option value="Unemp">Unemployment (%)</option>
</select>
<button id="go">Show</button>
</div>

<div id="legend">
<strong>Language Families:</strong>
<span style="margin-left:8px;padding:3px 6px;border-radius:4px;background:rgba(150,200,255,.9)">Germanic</span>
<span style="margin-left:6px;padding:3px 6px;border-radius:4px;background:rgba(170,255,170,.9)">Romance</span>
<span style="margin-left:6px;padding:3px 6px;border-radius:4px;background:rgba(255,160,160,.95)">Slavic</span>
<span style="margin-left:6px;padding:3px 6px;border-radius:4px;background:rgba(220,180,255,.9)">Baltic</span>
<span style="margin-left:6px;padding:3px 6px;border-radius:4px;background:rgba(255,255,150,.9)">Other</span>
</div>

<div id="mapWrap">
<img id="mapImg" src="https://raw.githubusercontent.com/aceg-pl/tr/main/Europe.png" alt="Europe map">
</div>

<div id="status">Ready.</div>

<script>
/* config */
const MAP_W=1532,MAP_H=1253;
const COUNTRIES=[
{cc:'pt',code:'PT',x:7,y:83,fam:'fam-rom'},
{cc:'es',code:'ES',x:16,y:85,fam:'fam-rom'},
{cc:'fr',code:'FR',x:27,y:69,fam:'fam-rom'},
{cc:'be',code:'BE',x:30,y:62.5,fam:'fam-geo'},
{cc:'nl',code:'NL',x:32,y:57,fam:'fam-geo'},
{cc:'ie',code:'IE',x:15,y:51,fam:'fam-geo'},
{cc:'gb',code:'UK',x:22,y:55,fam:'fam-geo'},
{cc:'dk',code:'DK',x:36.5,y:48,fam:'fam-geo'},
{cc:'de',code:'DE',x:37.5,y:60,fam:'fam-geo'},
{cc:'ch',code:'CH',x:35,y:71,fam:'fam-rom'},
{cc:'at',code:'AT',x:42,y:69,fam:'fam-geo'},
{cc:'se',code:'SE',x:42.5,y:32,fam:'fam-geo'},
{cc:'no',code:'NO',x:39.5,y:26,fam:'fam-geo'},
{cc:'fi',code:'FI',x:54,y:27,fam:'fam-ural'},
{cc:'ee',code:'EE',x:55.5,y:40,fam:'fam-ural'},
{cc:'lv',code:'LV',x:55,y:44,fam:'fam-bal'},
{cc:'lt',code:'LT',x:54,y:48.5,fam:'fam-bal'},
{cc:'pl',code:'PL',x:49.5,y:57,fam:'fam-sla'},
{cc:'cz',code:'CZ',x:44,y:63,fam:'fam-sla'},
{cc:'sk',code:'SK',x:52,y:66,fam:'fam-sla'},
{cc:'hu',code:'HU',x:51,y:69.5,fam:'fam-ural'},
{cc:'si',code:'SI',x:45,y:73,fam:'fam-sla'},
{cc:'hr',code:'HR',x:45,y:76,fam:'fam-sla'},
{cc:'rs',code:'RS',x:54,y:74.5,fam:'fam-sla'},
{cc:'ro',code:'RO',x:59.5,y:70.5,fam:'fam-rom'},
{cc:'bg',code:'BG',x:61,y:78,fam:'fam-sla'},
{cc:'gr',code:'GR',x:56,y:88,fam:'fam-rom'},
{cc:'it',code:'IT',x:39.5,y:79.5,fam:'fam-rom'}
];
const PLACES=COUNTRIES; /* keep same variable name style */
const flagURL=(c)=>`https://flagcdn.com/24x18/${c.toLowerCase()}.png`;
const mapWrap=document.getElementById('mapWrap'),img=document.getElementById('mapImg'),status=document.getElementById('status');

/* helpers: pin placement & scaling */
function placePin(place,txt,cls){
const imgRect=img.getBoundingClientRect();
const el=document.createElement('div');
el.className='pin '+(place.fam||'');
el.style.left=Math.round(place.x/100*imgRect.width)+'px';
el.style.top=Math.round(place.y/100*imgRect.height)+'px';
el.innerHTML=`<img src="${flagURL(place.cc)}" alt="${place.code}">`+
`<span style="font-weight:600;margin-right:6px">${place.code}</span>`+
`<span class="v">${txt}</span>`;
mapWrap.appendChild(el);
return el;
}
function scalePins(){
const w=img.clientWidth;const base=Math.max(10,Math.round(w/60));
document.documentElement.style.setProperty('--base-font',base+'px');
mapWrap.querySelectorAll('.pin').forEach(p=>{
p.style.fontSize=base+'px';
const imgTag=p.querySelector('img'); if(imgTag){imgTag.style.width=Math.max(12,Math.round(base*1.2))+'px'; imgTag.style.height=Math.max(8,Math.round(base*0.8))+'px';}
});
}

/* format numbers */
function fmt(v,stat){
if(v==null||v==='?') return '–';
if(stat==='GDP') return (v/1e9).toFixed(1)+'B';
if(stat==='GDPpc') return Math.round(v).toLocaleString();
if(stat==='Infl') return (Math.round(v*10)/10)+'%';
if(stat==='Unemp') return (Math.round(v*10)/10)+'%';
return v;
}

/* compare two vals -> arrow */
function trendArrow(lat,prev,stat){
if(lat==null||prev==null) return '';
const a=Number(lat),b=Number(prev);
if(isNaN(a)||isNaN(b)) return '';
if(Math.abs(a-b)<=Math.abs(b)*0.005) return ' →';
return a>b? ' ⬆️' : ' ⬇️';
}

/* WORLD BANK fetch utility (reliable, keyless)
   returns {latest:value,prev:value,year:yyyy}
*/
async function wbFetch(cc,indicator){
const iso=cc.toLowerCase();
const url=`https://api.worldbank.org/v2/country/${iso}/indicator/${indicator}?format=json&per_page=6&date=2000:2025`;
try{
const r=await fetch(url);
if(!r.ok) throw 0;
const j=await r.json();
if(!Array.isArray(j) || j.length<2) throw 0;
const data=j[1].filter(d=>d.value!==null);
if(data.length===0) return {latest:null,prev:null};
const latest=data[0];
const prev=data[1]||null;
return {latest:latest.value,prev:prev?prev.value:null,year:latest.date||''};
}catch(e){return {latest:null,prev:null};}
}

/* OECD attempt: best-effort generic query via SDMX-JSON.
   Many OECD endpoints are dataset-specific and may CORS-block.
   We try and if anything fails, fallback to World Bank.
   The function returns same shape as wbFetch.
*/
async function oecdFetch(cc,indicatorKey){
/* mapping attempted: indicatorKey -> OECD dataset/measure attempt
   This is a best-effort quick mapping; expand later if you want precise dataset codes.
*/
const map={
'GDP':'NAAGDP', /* placeholder - many OECD GDP series require detailed dataset */
'GDPpc':'B1_GE', /* placeholder */
'Infl':'CPI', /* placeholder */
'Unemp':'LRHUTTTT' /* unemployment rate series code example in some OECD datasets */
};
/* Try to craft a generic SDMX query on stats.oecd.org - may fail due to dataset specifics or CORS */
const ds=map[indicatorKey];
if(!ds) return {latest:null,prev:null};
const url=`https://stats.oecd.org/SDMX-JSON/data/${ds}/${cc}/all`;
try{
const r=await fetch(url);
if(!r.ok) throw 0;
const j=await r.json();
/* parse SDMX-JSON: find series -> observations -> latest two */
const series = j.dataSets && j.dataSets[0] && j.structure && j.structure.series ? j.dataSets[0].series : null;
if(!series){ return {latest:null,prev:null}; }
const keys=Object.keys(series);
if(!keys.length) return {latest:null,prev:null};
const s=series[keys[0]];
const obs=s.observations; const years=Object.keys(obs).sort((a,b)=>a-b).map(n=>Number(n));
if(!years.length) return {latest:null,prev:null};
const last=years[years.length-1],prev=years[years.length-2]||null;
const latestVal=obs[last] ? obs[last][0] : null;
const prevVal= prev && obs[prev] ? obs[prev][0] : null;
return {latest:latestVal,prev:prevVal,year:last};
}catch(e){return {latest:null,prev:null};}
}

/* indicator -> World Bank code mapping */
const WB_IND = {
'GDP':'NY.GDP.MKTP.CD',
'GDPpc':'NY.GDP.PCAP.CD',
'Infl':'FP.CPI.TOTL.ZG',
'Unemp':'SL.UEM.TOTL.ZS'
};

/* main flow: for each place, attempt OECD then fallback to WB */
async function showStat(statKey){
document.querySelectorAll('.pin').forEach(n=>n.remove());
status.textContent='Loading '+statKey+' (OECD → WB)...';
const batch=PLACES.slice(); // clone
// chunk to avoid hammering (8 at a time)
const chunkSize=8;
for(let i=0;i<batch.length;i+=chunkSize){
const group=batch.slice(i,i+chunkSize);
await Promise.all(group.map(async p=>{
// try OECD
let r = await oecdFetch(p.code, statKey);
if(r && r.latest!=null){
const t=fmt(r.latest, statKey)+trendArrow(r.latest,r.prev,statKey);
placePin(p, (t+' ('+ (r.year||'') +')') );
return;
}
// fallback to World Bank
r = await wbFetch(p.code, WB_IND[statKey]);
if(r && r.latest!=null){
const t=fmt(r.latest, statKey)+trendArrow(r.latest,r.prev,statKey);
placePin(p, (t+' ('+ (r.year||'') +')') );
return;
}
// nothing found
placePin(p,'–');
}));
scalePins();
}
status.textContent='Done.';
}

/* UI handlers */
document.getElementById('go').addEventListener('click',()=>{
const k=document.getElementById('stat').value;
showStat(k);
});

/* keep pins positioned on resize */
let rt;
function reposition(){
const imgRect=img.getBoundingClientRect();
document.querySelectorAll('.pin').forEach(pin=>{
const c=pin.querySelector('span') && pin.querySelector('span').previousSibling;
});
scalePins();
}
window.addEventListener('resize',()=>{clearTimeout(rt); rt=setTimeout(reposition,120);});
img.addEventListener('load',()=>{scalePins(); reposition();});
</script>
</body>
</html>
